<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BeitaToken (BTA) ‚Äì Dashboard</title>
  <meta name="description" content="BeitaToken (BTA) ‚Äì dashboard with wallet connect, mining, deposit, withdraw UI."/>
  <style>
    :root{
      --bg:#0b1020; --text:#e9f1ff; --muted:#99a3b3;
      --accent:#29d391; --accent2:#3aa8ff; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);line-height:1.45}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{text-align:center;padding:18px 0}
    h1{margin:.2rem 0;font-size:1.6rem}
    .card{background:rgba(255,255,255,.04);padding:16px;border-radius:var(--radius);box-shadow:0 6px 20px rgba(0,0,0,.4);margin:12px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:transparent;color:var(--text);cursor:pointer}
    .btn:hover{opacity:.95}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#041017;border:none}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:860px){.grid{grid-template-columns:1fr}}
    .balance{font-weight:800;font-size:1.4rem}
    .muted{color:var(--muted);font-size:.95rem}
    .small{font-size:.9rem}
    input,select{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);padding:8px 10px;border-radius:10px;color:var(--text);width:100%}
    label{font-size:.9rem;color:var(--muted);margin-bottom:6px;display:block}
    .wallet-addr{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.02);padding:10px;border-radius:10px;margin:8px 0;word-break:break-word}
    .log{background:rgba(255,255,255,.02);padding:10px;border-radius:10px;max-height:180px;overflow:auto;font-size:.9rem}
    .notice{background:rgba(255,255,255,.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);font-size:.95rem}
    .danger{color:#ffb3b3}
  </style>
</head>
<body>
  <header class="container">
    <h1>üöÄ BeitaToken Dashboard</h1>
    <div class="muted small"> Real Best mining pool<strong> Start making real money</strong> You're safe with us</div>
  </header>

  <main class="container">
    <!-- Wallet Connect / Balances -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <strong>Wallet Connection</strong>
          <div class="muted small">Connect your wallet and click start mining to earning real money with BeitaToken.</div>
        </div>
        <div class="row">
          <button id="connectBtn" class="btn btn-primary">üîó Connect Wallet</button>
          <button id="disconnectBtn" class="btn hidden">üîå Disconnect</button>
        </div>
      </div>

      <div style="margin-top:12px" class="row">
        <div>
          <div class="muted">Status</div>
          <div id="statusText" class="small muted">üî¥ Not connected</div>
        </div>
        <div style="min-width:220px">
          <div class="muted">Network</div>
          <div id="networkText" class="small muted"></div>
        </div>
        <div style="min-width:220px">
          <div class="muted">Account</div>
          <div id="accountText" class="small muted"></div>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,.03)">

      <div class="grid">
        <div>
          <strong>‚õè Mining Pool</strong>
          <div class="muted small">Mining pool balance that accrues while mining</div>
          <div style="margin-top:8px" class="balance"><span id="poolBalance">0.0000</span> BTA</div>
          <div class="row" style="margin-top:10px">
            <button id="startMining" class="btn">Start Mining</button>
            <button id="stopMining" class="btn">Stop Mining</button>
            <button id="autoConvert" class="btn">Auto Convert Off</button>
          </div>
          <div style="margin-top:8px" class="muted small" id="miningStatus">Mining stopped.</div>
        </div>

        <div>
          <strong>üëõ Wallet</strong>
          <div class="muted small">BTA Wallet balance</div>
          <div style="margin-top:8px" class="balance"><span id="walletBalance">0.0000</span> BTA</div>

          <div style="margin-top:10px">
            <label for="convertAmount">Convert from Pool ‚Üí Wallet</label>
            <div class="row">
              <input id="convertAmount" type="number" step="0.0001" placeholder="Amount (BTA)">
              <button id="convertBtn" class="btn btn-primary">Convert</button>
            </div>
            <div class="muted small" style="margin-top:6px">Moves mined BTA into your wallet balance.</div>
          </div>

          <!-- Coming soon Button -->
          <!-- <div style="margin-top:10px" class="row">
            <button id="depositBtn" class="btn">üí≥ Deposit</button>
            <button id="withdrawBtn" class="btn">üí∏ Withdraw</button>
          </div> -->
        </div>
      </div>
    </section>

    <!-- Deposit Addresses (Info only)
    <section id="depositSection" class="card hidden">
      <strong>Deposit Wallets üí≥ ‚Äî INFO ONLY</strong>
      <div class="muted small">Addresses listed below are for deposit information only. <strong>Do not send upgrade/fee payments</strong> to these addresses. This demo never requires real payments.</div>
      <div style="margin-top:10px">
        <div class="wallet-addr"><div>USDT (TRC20): <span class="small">TSThbFbqfViVxNSg9cnQ6taqSghH8p6kyc</span></div><button class="btn copyBtn" data-copy="TSThbFbqfViVxNSg9cnQ6taqSghH8p6kyc">Copy</button></div>
        <div class="wallet-addr"><div>BTC: <span class="small">bc1qgwcsk7ejyq3u5747xa9r49lyn3a3dpk7e2xx26</span></div><button class="btn copyBtn" data-copy="bc1qgwcsk7ejyq3u5747xa9r49lyn3a3dpk7e2xx26">Copy</button></div>
        <div class="wallet-addr"><div>Ethereum (ETH): <span class="small">0x88fd1a2E86C723f522d2e47BB725b4633A12cf20</span></div><button class="btn copyBtn" data-copy="0x88fd1a2E86C723f522d2e47BB725b4633A12cf20">Copy</button></div>
        <div class="wallet-addr"><div>XRP: <span class="small">rE5apkmMAn1WC5UEoVScT6kATnocbSqEzu</span></div><button class="btn copyBtn" data-copy="rE5apkmMAn1WC5UEoVScT6kATnocbSqEzu">Copy</button></div>
        <div class="wallet-addr"><div>BNB Smart Chain: <span class="small">0x88fd1a2E86C723f522d2e47BB725b4633A12cf20</span></div><button class="btn copyBtn" data-copy="0x88fd1a2E86C723f522d2e47BB725b4633A12cf20">Copy</button></div>
      </div>
    </section> -->

    <!-- Withdraw Form -->
    <!-- <section id="withdrawSection" class="card hidden">
      <strong>Withdraw</strong>
      <div class="muted small"><strong></strong> <span class="danger"></span></div>

      <form id="withdrawForm" style="margin-top:10px">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div>
            <label for="asset">Asset</label>
            <select id="asset">
              <option value="BTA">BTA</option>
              <option value="USDT-TRC20">USDT (TRC20)</option>
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="XRP">XRP</option>
              <option value="BNB">BNB (BSC)</option>
            </select>
          </div>
          <div>
            <label for="amount">Amount</label>
            <input id="amount" type="number" step="0.0001" placeholder="Amount to withdraw" required>
          </div>
        </div> -->

        <!-- <div style="margin-top:8px">
          <label for="dest">Destination Address</label>
          <input id="dest" type="text" placeholder="Destination address for the selected asset" required>
        </div>

        <div style="margin-top:8px">
          <div class="muted small">Fee: <strong>30%</strong>The fee will be calculated and displayed before processing.</div>
          <div style="margin-top:6px" class="row">
            <button type="button" id="calcFeeBtn" class="btn">Calculate Fee</button>
            <button type="submit" class="btn btn-primary">Process Withdrawal </button>
            <button type="button" id="cancelWithdraw" class="btn">Cancel</button>
          </div>
        </div>

        <div style="margin-top:10px" id="feeInfo" class="notice hidden"></div>
      </form>
    </section> -->

    <!-- Activity & queued requests -->
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Activity Log</strong>
        <div class="muted small">Local state is saved to your browser only.</div>
      </div>
      <div id="activity" class="log" style="margin-top:8px"></div>

      <div style="margin-top:10px">
        <strong>Activity Log</strong>
        <div id="requests" class="log" style="margin-top:8px"></div>
      </div>
    </section>
  </main>

  <script>
    /* --------------------------
       UTILITIES (safe arithmetic)
       -------------------------- */
    function toFixedNumber(n, decimals = 8) {
      // return number rounded to `decimals` safely
      return Math.round((Number(n) || 0) * Math.pow(10, decimals)) / Math.pow(10, decimals);
    }
    function formatUI(n) { return toFixedNumber(n,8).toFixed(4); }
    function safeAdd(a,b){ return toFixedNumber(Number(a||0) + Number(b||0), 8); }
    function safeSub(a,b){ return toFixedNumber(Number(a||0) - Number(b||0), 8); }
    function safeMul(a,b){ return toFixedNumber(Number(a||0) * Number(b||0), 8); }

    /* --------------------------
       STATE & Persistence
       -------------------------- */
    const state = {
      connected:false,
      account:null,
      chain:null,
      pool: 0.0,
      wallet: 0.0,
      feePool: 0.0,   //  internal fee collected
      requests: [],   // queued simulated withdrawals
      mining:false,
      miningTimer:null,
      rewardPerTick: 0.005, // BTA per tick
      tickMs: 2000,
      autoConvert: false
    };
    function saveState(){
      localStorage.setItem('bta_pool', String(state.pool));
      localStorage.setItem('bta_wallet', String(state.wallet));
      localStorage.setItem('bta_feePool', String(state.feePool));
      localStorage.setItem('bta_requests', JSON.stringify(state.requests || []));
    }
    function loadState(){
      const p = parseFloat(localStorage.getItem('bta_pool') || '0');
      const w = parseFloat(localStorage.getItem('bta_wallet') || '0');
      const f = parseFloat(localStorage.getItem('bta_feePool') || '0');
      try { state.requests = JSON.parse(localStorage.getItem('bta_requests') || '[]') } catch(e){ state.requests = [] }
      if(!isNaN(p)) state.pool = toFixedNumber(p,8);
      if(!isNaN(w)) state.wallet = toFixedNumber(w,8);
      if(!isNaN(f)) state.feePool = toFixedNumber(f,8);
    }

    /* --------------------------
       ELEMENTS
       -------------------------- */
    const el = id => document.getElementById(id);
    const connectBtn = el('connectBtn');
    const disconnectBtn = el('disconnectBtn');
    const statusText = el('statusText');
    const networkText = el('networkText');
    const accountText = el('accountText');
    const poolBalance = el('poolBalance');
    const walletBalance = el('walletBalance');
    const startMining = el('startMining');
    const stopMining = el('stopMining');
    const miningStatus = el('miningStatus');
    const convertBtn = el('convertBtn');
    const convertAmount = el('convertAmount');
    const autoConvertBtn = el('autoConvert');
    const depositBtn = el('depositBtn');
    const withdrawBtn = el('withdrawBtn');
    const depositSection = el('depositSection');
    const withdrawSection = el('withdrawSection');
    const withdrawForm = el('withdrawForm');
    const feeInfo = el('feeInfo');
    const calcFeeBtn = el('calcFeeBtn');
    const cancelWithdraw = el('cancelWithdraw');
    const activity = el('activity');
    const requestsEl = el('requests');

    /* --------------------------
       UI / Logging helpers
       -------------------------- */
    function log(msg){
      const t = new Date().toLocaleString();
      activity.innerHTML = `<div>[${t}] ${escapeHtml(msg)}</div>` + activity.innerHTML;
    }
    function logRequest(req){
      const t = new Date(req.time).toLocaleString();
      requestsEl.innerHTML = `<div>[${t}] ${escapeHtml(req.summary)}</div>` + requestsEl.innerHTML;
    }
    function updateBalancesUI(){
      poolBalance.textContent = formatUI(state.pool);
      walletBalance.textContent = formatUI(state.wallet);
      saveState();
    }
    function setConnectedUI(on){
      state.connected = !!on;
      statusText.textContent = on ? 'üü¢ Connected' : 'üî¥ Not connected';
      connectBtn.classList.toggle('hidden', on);
      disconnectBtn.classList.toggle('hidden', !on);
    }
    function setAccountUI(account){
      accountText.textContent = account ? account : '';
    }
    function setNetworkUI(chain){
      networkText.textContent = chain ? chain : '';
    }
    function escapeHtml(text){
      return String(text).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    /* --------------------------
       Wallet (MetaMask) Connect
       -------------------------- */
    async function connectWallet(){
      if(!window.ethereum){
        alert('No injected wallet detected. Install MetaMask or a compatible wallet to test connection.');
        return;
      }
      try{
        const accounts = await ethereum.request({ method:'eth_requestAccounts' });
        state.account = accounts && accounts[0] ? accounts[0] : null;
        setConnectedUI(!!state.account);
        setAccountUI(state.account);
        try {
          const chainId = await ethereum.request({ method:'eth_chainId' });
          setNetworkUI(chainId + (chainId ? ` (chain)` : ''));
        } catch(e){}
        log(`Connected account ${state.account || '(none)'}`);
      }catch(e){
        console.error('connect error', e);
        alert('Connection rejected or failed.');
      }
    }
    function disconnectWallet(){
      // MetaMask doesn't provide programmatic disconnect. We clear local UI state for demo.
      state.account = null;
      setConnectedUI(false);
      setAccountUI('');
      setNetworkUI('');
      // stop mining when disconnect
      stopMiningProcess();
      log('Disconnected wallet (UI only).');
    }

    /* Listen to provider changes (if present) */
    if(window.ethereum){
      ethereum.on?.('accountsChanged', (accounts) => {
        state.account = accounts && accounts[0] ? accounts[0] : null;
        setConnectedUI(!!state.account);
        setAccountUI(state.account);
        log('accountsChanged event');
        if(!state.account) stopMiningProcess();
      });
      ethereum.on?.('chainChanged', (chainId) => {
        setNetworkUI(chainId);
        log('chainChanged: ' + chainId);
      });
    }

    /* --------------------------
       Mining logic
       -------------------------- */
    function startMiningProcess(){
      if(!state.connected) { alert('Connect wallet first to start mining.'); return; }
      if(state.mining) return;
      state.mining = true;
      miningStatus.textContent = 'Mining‚Ä¶';
      state.miningTimer = setInterval(() => {
        state.pool = safeAdd(state.pool, state.rewardPerTick);
        if(state.autoConvert){
          // optionally auto-convert all
          state.wallet = safeAdd(state.wallet, state.rewardPerTick);
        }
        updateBalancesUI();
      }, state.tickMs);
      log('Mining started.');
    }
    function stopMiningProcess(){
      if(state.miningTimer) clearInterval(state.miningTimer);
      state.mining = false;
      miningStatus.textContent = 'Mining stopped.';
      state.miningTimer = null;
      log('Mining stopped.');
    }

    /* --------------------------
       Convert Pool -> Wallet
       -------------------------- */
    function convertPoolToWallet(){
      const raw = parseFloat(convertAmount.value || '0');
      const amount = toFixedNumber(raw,8);
      if(!(amount > 0)) { alert('Enter a valid amount to convert.'); return; }
      if(amount > state.pool){ alert('Insufficient pool balance to convert.'); return; }
      state.pool = safeSub(state.pool, amount);
      state.wallet = safeAdd(state.wallet, amount);
      updateBalancesUI();
      log(`Converted ${formatUI(amount)} BTA from pool to wallet (sim).`);
      convertAmount.value = '';
    }

    /* --------------------------
       Withdraw logic (simulation)
       -------------------------- */
    function calculateFee(amount){
      // 30% fee
      return safeMul(amount, 0.30);
    }

    function showFeeInfo(asset, amount){
      const fee = calculateFee(amount);
      const net = safeSub(amount, fee);
      feeInfo.classList.remove('hidden');
      feeInfo.innerHTML = `<div><strong>Simulation:</strong> Asset: ${escapeHtml(asset)} ‚Äî Requested: ${formatUI(amount)} ‚Äî Fee (30%): ${formatUI(fee)} ‚Äî Net to send (sim): ${formatUI(net)}</div>
        <div class="muted small" style="margin-top:6px">For non-BTA assets, the fee will be charged in BTA from your simulated wallet. This is a demo only; no real transfers occur.</div>`;
      return { fee, net };
    }

    async function processWithdrawalSubmission(asset, amount, dest){
      // amount is number
      // fee is calculated as 30% of requested amount (in that asset, but for non-BTA fee is taken in BTA simulation)
      const fee = calculateFee(amount);
      const net = safeSub(amount, fee);

      if(asset === 'BTA'){
        // For BTA ‚Üí we require the wallet to have at least the requested amount (simulation)
        if(amount > state.wallet){
          alert('Insufficient BTA wallet balance for this withdrawal. Convert more from the pool or reduce amount.');
          return;
        }
        // Confirm
        const ok = confirm(`Simulated withdraw: ${formatUI(amount)} BTA\nFee (30%): ${formatUI(fee)} BTA\nNet (simulated) to destination: ${formatUI(net)} BTA\n\nThis is a SIMULATION only. No real funds will be sent. Confirm to proceed (simulation).`);
        if(!ok) return;
        // Deduct the full requested amount from wallet (simulate outgoing transfer)
        state.wallet = safeSub(state.wallet, amount);
        // Collect fee into simulated feePool (internal)
        state.feePool = safeAdd(state.feePool, fee);
        // Save a simulated request record (for display)
        const req = {
          id: 'sim-' + Date.now(),
          asset, requested: amount, fee, net, dest, time: Date.now(),
          summary: `BTA withdrawal simulated: ${formatUI(amount)} requested, fee ${formatUI(fee)} -> net ${formatUI(net)} to ${dest}`
        };
        state.requests.unshift(req);
        saveState();
        updateBalancesUI();
        log(`Processed simulated BTA withdrawal: ${formatUI(amount)} (fee ${formatUI(fee)}) to ${dest}`);
        logRequest(req);
        alert('Withdrawal processed. Check Activity / Queued Requests.');
        return;
      }

      // Non-BTA asset: require fee to be paid in BTA from wallet (simulation)
      // Check wallet BTA balance to cover fee
      if(state.wallet < fee){
        alert(`Insufficient BTA wallet balance to pay the simulated fee (${formatUI(fee)} BTA). Convert more mined BTA into wallet first.`);
        return;
      }
      const ok2 = confirm(`Simulated withdraw request:\nAsset: ${asset}\nAmount: ${formatUI(amount)}\nFee: ${formatUI(fee)} BTA (will be deducted from your simulated BTA wallet)\nNet (sim) to send in ${asset}: ${formatUI(net)}\nDestination: ${dest}\n\nThis is a SIMULATION only. No real funds will be transferred. Confirm to queue simulated request.`);
      if(!ok2) return;
      // Deduct fee in BTA from wallet, record request
      state.wallet = safeSub(state.wallet, fee);
      state.feePool = safeAdd(state.feePool, fee);
      const req = {
        id: 'sim-' + Date.now(),
        asset, requested: amount, fee, net, dest, time: Date.now(),
        summary: `${asset} withdrawal simulated: ${formatUI(amount)} requested, fee ${formatUI(fee)} BTA -> net ${formatUI(net)} to ${dest}`
      };
      state.requests.unshift(req);
      saveState();
      updateBalancesUI();
      log(`Queued simulated ${asset} withdrawal: ${formatUI(amount)} (fee ${formatUI(fee)} BTA) to ${dest}`);
      logRequest(req);
      alert('Withdrawal request queued. Check Activity / Queued Requests.');
    }

    /* --------------------------
       Wire up UI events
       -------------------------- */
    connectBtn.addEventListener('click', connectWallet);
    disconnectBtn.addEventListener('click', disconnectWallet);

    startMining.addEventListener('click', () => startMiningProcess());
    stopMining.addEventListener('click', () => stopMiningProcess());

    autoConvertBtn.addEventListener('click', () => {
      state.autoConvert = !state.autoConvert;
      autoConvertBtn.textContent = state.autoConvert ? 'Auto Convert On' : 'Auto Convert Off';
      log('Auto-convert toggled: ' + (state.autoConvert ? 'on' : 'off'));
    });

    convertBtn.addEventListener('click', convertPoolToWallet);

    depositBtn.addEventListener('click', () => {
      depositSection.classList.toggle('hidden');
    });

    withdrawBtn.addEventListener('click', () => {
      if(!state.connected) { alert('Connect a wallet first to use withdraw.'); return; }
      withdrawSection.classList.toggle('hidden');
      // hide fee info on open
      feeInfo.classList.add('hidden');
    });

    // Withdraw form actions
    calcFeeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const a = document.getElementById('asset').value;
      const amt = toFixedNumber(parseFloat(document.getElementById('amount').value || '0'), 8);
      if(!(amt > 0)){ alert('Enter a valid amount to calculate fee.'); return; }
      showFeeInfo(a, amt);
    });

    withdrawForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const asset = document.getElementById('asset').value;
      const amt = toFixedNumber(parseFloat(document.getElementById('amount').value || '0'), 8);
      const dest = String(document.getElementById('dest').value || '').trim();
      if(!(amt > 0)){ alert('Enter a valid amount.'); return; }
      if(dest.length < 6){ alert('Enter a valid destination address.'); return; }
      // Process with confirmation & simulated fee
      processWithdrawalSubmission(asset, amt, dest);
      withdrawForm.reset();
      feeInfo.classList.add('hidden');
    });

    cancelWithdraw.addEventListener('click', () => {
      withdrawSection.classList.add('hidden');
      feeInfo.classList.add('hidden');
      withdrawForm.reset();
    });

    // Copy buttons for deposit addresses
    document.addEventListener('click', (ev) => {
      if(ev.target && ev.target.classList.contains('copyBtn')){
        const text = ev.target.getAttribute('data-copy') || '';
        if(!text) return;
        navigator.clipboard.writeText(text).then(() => {
          const orig = ev.target.textContent;
          ev.target.textContent = 'Copied';
          setTimeout(() => ev.target.textContent = orig, 900);
        }).catch(()=> alert('Copy failed'));
      }
    });

    /* --------------------------
       Initialization
       -------------------------- */
    function init(){
      loadState();
      updateBalancesUI();
      // show existing queued requests in UI
      if(Array.isArray(state.requests) && state.requests.length){
        state.requests.forEach(r => logRequest(r));
      }
      // default disconnected UI
      setConnectedUI(false);
      setAccountUI('');
      setNetworkUI('');
      // log initial state
      log('initialized. Local state restored.');
    }

    init();
  </script>
</body>
</html>
